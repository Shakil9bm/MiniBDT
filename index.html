<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniBDT — Cloud Ad Player</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--accent:#ff5fa2;--muted:#9aa7b8;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Poppins', sans-serif;background:linear-gradient(180deg,#071026 0%,#0f1724 100%);color:#fff}
    .wrap{max-width:400px;margin:24px auto;padding:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02)}
    h1{margin:6px 0 10px;color:var(--accent);font-size:20px;text-align:center}
    p.lead{color:var(--muted);text-align:center;margin:0 0 14px}
    .ad-area{width:100%;aspect-ratio:9/16;border-radius:12px;background:linear-gradient(180deg,#0f1a2b,#071026);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;padding:12px;text-align:center}
    .ad-placeholder{width:90%;aspect-ratio:9/16;border-radius:10px;background:linear-gradient(90deg,#101827,#122033);display:flex;align-items:center;justify-content:center;color:#c4d9e6;font-size:16px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    button.btn{padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--accent);color:#081219}
    .btn-muted{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .timer{margin-top:8px;font-weight:700;color:var(--accent)}
    .status{margin-top:6px;color:#cbd5e1}
    footer{margin-top:16px;text-align:center;color:#93a3b6;font-size:13px}
    .meta{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
    .chip{background:rgba(255,255,255,0.02);padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.02);font-size:13px;color:var(--muted)}
    @media(max-width:520px){
      .wrap{padding:12px;}
      .ad-area{width:100%;}
      .ad-placeholder{width:95%;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>MiniBDT — Cloud Ad Player</h1>
      <p class="lead">Watch rewarded ads to earn. Ads are powered by Monetag. Do not skip — rewards are given only after full view.</p>

      <div class="meta">
        <div class="chip">Ad Duration: <strong>18s</strong></div>
        <div class="chip">Reward: <strong>1000 BTTC</strong></div>
        <div class="chip">Daily Limit: <strong>15 ads</strong></div>
      </div>

      <div class="ad-area" id="adArea">
        <div class="ad-placeholder" id="adPlaceholder">Ad will appear here (Monetag)</div>
        <div class="timer" id="timer">Time left: 18s</div>
        <div class="status" id="status">Not started</div>

        <div class="controls">
          <button id="startBtn" class="btn btn-primary">▶ Start Ad</button>
          <button id="closeBtn" class="btn btn-muted" disabled>⛔ Close</button>
        </div>
      </div>

      <div style="margin-top:12px;font-size:13px;color:#9fb1c9;text-align:center">
        Note: If an ad fails to load, no reward will be issued. Refreshing the page will not reset progress. All texts are in English.
      </div>

      <div style="margin-top:8px;font-size:14px;color:#ff5fa2;text-align:center">
        Balance: <span id="balance">0</span> BTTC | Ads Watched Today: <span id="adsCount">0</span>
      </div>
    </div>

    <footer>© MiniBDT | Developed by Shakil Hassan</footer>
  </div>

  <!-- Monetag SDK -->
  <script src="//libtl.com/sdk.js" data-zone="10030713" data-sdk="show_10030713"></script>

  <script>
    // Telegram Bot Token
    const TELEGRAM_BOT_TOKEN = "8463666017:AAEMZW9bxeSKXbynHd9GArXUxCZnZcJxYpQ";

    const AD_DURATION = 18;
    const DAILY_LIMIT = 15;
    const REWARD_AMOUNT = 1000;
    const SDK_GLOBAL = 'show_10030713';

    const startBtn = document.getElementById('startBtn');
    const closeBtn = document.getElementById('closeBtn');
    const timerEl = document.getElementById('timer');
    const statusEl = document.getElementById('status');
    const adPlaceholder = document.getElementById('adPlaceholder');
    const balanceEl = document.getElementById('balance');
    const adsCountEl = document.getElementById('adsCount');

    let timer = AD_DURATION;
    let interval = null;
    let adPlaying = false;

    let userBalance = parseInt(localStorage.getItem('userBalance') || '0');
    let adsWatchedToday = parseInt(localStorage.getItem('adsWatchedToday') || '0');

    function updateUI() {
      balanceEl.textContent = userBalance;
      adsCountEl.textContent = adsWatchedToday;
      timerEl.textContent = `Time left: ${timer}s`;
    }
    updateUI();

    const LS_KEY = 'minibdt_ads_progress_v2';
    const state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return {date: todayStr(), inProgress:false, startTs:null};
        const s = JSON.parse(raw);
        if(s.date !== todayStr()){ return {date: todayStr(), inProgress:false, startTs:null}; }
        return s;
      }catch(e){return {date: todayStr(), inProgress:false, startTs:null};}
    }

    function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }
    function todayStr(){ const d=new Date(); return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate(); }

    async function showMonetagAd(){
      const fn = window[SDK_GLOBAL];
      if(!fn){
        adPlaceholder.textContent = '⚠️ Monetag SDK not loaded. Check zone ID.';
        statusEl.textContent = 'Ad failed to load.';
        startBtn.disabled = false;
        return false;
      }
      try{
        statusEl.textContent = 'Requesting ad from Monetag...';
        await fn({type: 'rewarded'});
        return true;
      }catch(err){
        adPlaceholder.textContent = '⚠️ Ad failed to load.';
        statusEl.textContent = 'Ad failed to load.';
        startBtn.disabled = false;
        return false;
      }
    }

    function canWatch(){ return adsWatchedToday < DAILY_LIMIT; }

    startBtn.addEventListener('click', async ()=>{
      if(!canWatch()){ alert('Daily limit reached (15 ads). Come back tomorrow.'); return; }
      startBtn.disabled = true;
      startBtn.style.opacity = 0.7;
      state.inProgress = true;
      state.startTs = Date.now();
      saveState(state);

      const ok = await showMonetagAd();
      if(!ok){ state.inProgress=false; state.startTs=null; saveState(state); startBtn.disabled=false; return; }

      startTimer(AD_DURATION);
    });

    function startTimer(seconds){
      timer = seconds;
      adPlaying = true;
      closeBtn.disabled = true;
      closeBtn.style.opacity = 0.5;
      updateUI();

      interval = setInterval(()=>{
        timer--;
        updateUI();
        if(timer <= 0){ clearInterval(interval); completeAd(); }
      },1000);
    }

    function completeAd(){
      adPlaying = false;
      state.inProgress = false;
      state.startTs = null;
      saveState(state);

      // Update balance and ads count
      userBalance += REWARD_AMOUNT;
      adsWatchedToday += 1;
      localStorage.setItem('userBalance', userBalance);
      localStorage.setItem('adsWatchedToday', adsWatchedToday);

      updateUI();

      adPlaceholder.textContent = `✅ Ad Completed! Reward: ${REWARD_AMOUNT} BTTC`;
      statusEl.textContent = `Ad finished — total balance: ${userBalance} BTTC, Ads watched today: ${adsWatchedToday}`;

      closeBtn.disabled = false;
      closeBtn.style.opacity = 1;
      closeBtn.textContent = '✔ Close';

      setTimeout(()=>{
        if(canWatch()){
          statusEl.textContent = 'Starting next ad...';
          setTimeout(()=>{
            startBtn.disabled = false;
            startBtn.click();
          },900);
        } else {
          statusEl.textContent = 'Daily limit reached.';
          startBtn.disabled = true;
        }
      },1200);
    }

    closeBtn.addEventListener('click', ()=>{
      if(adPlaying){ alert('You cannot close the ad before it ends. Please watch full 18 seconds.'); }
      else{ location.reload(); }
    });

    window.addEventListener('beforeunload', (e)=>{
      if(adPlaying){ e.preventDefault(); e.returnValue=''; }
    });

  </script>
</body>
    </html>
